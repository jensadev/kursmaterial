<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nunjucks</title>
    <link rel="stylesheet" href="/kursmaterial/css/reset.css">
    <link rel="stylesheet" href="/kursmaterial/css/style.css">
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-tomorrow.min.css" integrity="sha512-kSwGoyIkfz4+hMo5jkJngSByil9jxJPKbweYec/UgS+S1EgE45qm4Gea7Ks2oxQ7qiYyyZRn66A9df2lMtjIsw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>
    
<nav class="wrapper region">
    <div class="search-modal" id="search-modal">
    <form class="search">
        <label class="sr-only" for="search-input">Sök</label>
        <input class="search-control" autocomplete="off" type="search" placeholder="Sök..." id="search-input"
            aria-label="Sök" />
    </form>
    <ol id="search-results" class="search-modal-results flow hidden popout" aria-labelledby="search-input">
    </ol>
</div>
    <ul><li><a href="/">kursmaterial</a><ul><li><a href="/programmering-1/">programmering 1</a><ul><li><a href="/programmering-1/introduktion/">introduktion</a></li></ul></li>
<li><a href="/webbserver/">webbserver</a><ul><li><a href="/webbserver/installation/">installation</a></li>
<li><a href="/webbserver/node/">node</a></li>
<li><a href="/webbserver/express/">express</a></li>
<li><a href="/webbserver/nunjucks/">nunjucks</a></li>
<li><a href="/webbserver/layout-och-includes/">layout och includes</a></li>
<li><a href="/webbserver/query-parametrar/">query parametrar</a></li></ul></li>
<li><a href="/webbutveckling-1/">webbutveckling 1</a><ul><li><a href="/webbutveckling-1/introduktion/">introduktion</a></li></ul></li></ul></li></ul>
</nav>

    
<main class="wrapper">
    <article class="flow">
        <h1>Nunjucks</h1>
<p>Statiska HTML filer i all ära men de stora vinsterna i att köra en webbserver är att kunna skapa dynamiska sidor. För att göra detta så kan vi använda ett templating språk som heter Nunjucks.</p>
<h2>Installera Nunjucks</h2>
<p>Som med allt annat i Node.js så kan vi installera Nunjucks med npm. Nunjucks är ett templating språk. För att installera Nunjucks så kör vi följande kommando i terminalen:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> nunjucks</code></pre>
<h3>Templating språk</h3>
<p>Med ett templating språk kan vi skapa dynamiska HTML sidor. Det innebär att vi kan använda variabler, loopar och villkor i våra HTML filer. Nunjucks är ett populärt templating språk som används tillsammans med Express för att skapa dynamiska sidor.</p>
<h2>Använda Nunjucks i Express</h2>
<p>För att använda nunjucks i express så behöver vi konfigurera express att använda nunjucks som view engine. Öppna din <code>server.js</code> fil och lägg till följande kod:</p>
<pre class="language-js"><code class="language-js">nunjucks<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"views"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">autoescape</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">express</span><span class="token operator">:</span> app
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Det är viktigt att denna kod ligger efter att du har skapat din express app, annars kommer det inte att fungera. Denna kod konfigurerar nunjucks att använda mappen <code>views</code> som standardmapp för vyer och att använda <code>autoescape</code> för att undvika XSS-attacker.</p>
<h3>XSS-skydd</h3>
<p>XSS står för Cross-Site Scripting och är en typ av attack där en angripare kan injicera skadlig kod i en webbapplikation. För att skydda mot XSS-attacker så använder vi <code>autoescape: true</code> i vår nunjucks konfiguration. Detta innebär att nunjucks automatiskt kommer att rensa bort farlig HTML-kod från våra variabler.</p>
<h2>Skapa en vy</h2>
<p>Nu ska vi skapa en mapp som heter <code>views</code>. I mappen kommer vi att skapa alla våra nunjucks filer, eller vyer. Skapa en mapp som heter <code>views</code> i din projektmapp.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> views</code></pre>
<p>Skapa sedan en fil som heter <code>index.njk</code> i <code>views</code> mappen, du kan kopiera koden från din statiska HTML fil och klistra in den i <code>index.njk</code> filen.</p>
<h3>Nunjucks i VSCode</h3>
<p>För att få syntax highlighting och autocompletion i VSCode när du använder Nunjucks så kan du associera filerna med <code>html</code>. För att göra detta så öppnar du kommandopaletten i VSCode (Ctrl + Shift + P) och söker efter &quot;Change Language Mode&quot;. Välj sedan &quot;HTML&quot; som språk för Nunjucks-filerna. Detta gör att du får syntax highlighting och autocompletion när du skriver Nunjucks-kod.</p>
<p>Du kan nu skriva <code>html:5</code> och få en grundläggande HTML-struktur i din <code>index.njk</code> fil. Lägg sedan till följande kod i <code>index.njk</code>:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello node med express och nunjucks!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Welcome to my Express server with Nunjucks!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>
<h2>Rendera en vy</h2>
<p>Med Nunjucks kan vi rendera en vy och skicka data till den. För att göra detta så använder vi <code>render()</code> metoden i vår route. Med render menas att vi skapar en HTML-sida från vår Nunjucks-fil och skickar den som svar till klienten.</p>
<p>För att rendera en vy så ändrar vi i vår <code>server.js</code> fil och lägger till en route som renderar vår <code>index.njk</code> fil. Vi kan göra det så här:</p>
<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"index.njk"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Eftersom vi kör med <code>nodemon</code> så kommer servern att starta om automatiskt när vi sparar filen. Nu kan vi öppna webbläsaren och gå till <code>http://localhost:3000/</code> och se vår Nunjucks-renderade HTML-sida.</p>
<h4>Min sida fungerar inte?</h4>
<p>Om din sida inte fungerar så kan det bero på att du inte har konfigurerat Nunjucks korrekt eller att du har glömt att starta servern med <code>npm run dev</code>. Kontrollera att du har följt stegen ovan och att du har sparat filerna.</p>
<p>Det kan också vara så att du ser filen, men innehållet stämmer inte. Det är för att du har en statisk HTML-fil i public-mappen som Express servern skickar istället för din Nunjucks-renderade vy. Se till att du har tagit bort den statiska HTML-filen eller ändrat din route så att den renderar Nunjucks-filen.</p>
<p>I bash kan du använda <code>rm public/index.html</code> för att ta bort den statiska HTML-filen.</p>
<h2>Skicka data till vyn</h2>
<p>Nu när vi använder Nunjucks och <code>render()</code> metoden så kan vi skicka data till vyn. Vi kan skicka data som ett objekt som sedan kan användas i Nunjucks-filen.
För att skicka data till vyn så kan vi ändra vår route så här:</p>
<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"Hello Nunjucks"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"Welcome to my Express server with Nunjucks!"</span>
  <span class="token punctuation">}</span>
  response<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"index.njk"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Nu kan vi använda <code>title</code> och <code>message</code> i vår Nunjucks-fil. Ändra din <code>index.njk</code> fil så här:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Nunjucks<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>
<p>Nu kommer Nunjucks att rendera <code>title</code> och <code>message</code> från vårt dataobjekt i HTML-sidan. Du kan även lägga till fler variabler i dataobjektet och använda dem i din Nunjucks-fil.</p>

    </article>
</main>

    <footer class="wrapper region">
        &copy; Jens Andreasson 2025
    </footer>
    <script src="/kursmaterial/js/elasticlunr.min.js"></script>
    <script src="/kursmaterial/js/search.js"></script>
</body>

</html>